# Security Configuration Example
# Copy this file to .env and configure all security-related variables

# =============================================================================
# CRITICAL SECURITY SETTINGS - MUST BE CONFIGURED
# =============================================================================

# JWT Secrets (REQUIRED - Generate strong random strings)
# Minimum 32 characters, use: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
JWT_SECRET=CHANGE_THIS_TO_A_STRONG_RANDOM_STRING_MIN_32_CHARS
JWT_REFRESH_SECRET=CHANGE_THIS_TO_ANOTHER_STRONG_RANDOM_STRING_MIN_32_CHARS

# Encryption Key (REQUIRED - Must be exactly 64 hex characters / 32 bytes)
# Generate with: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
ENCRYPTION_KEY=CHANGE_THIS_TO_64_HEX_CHARACTERS_EXACTLY

# Session Secret (REQUIRED - Generate strong random string)
SESSION_SECRET=CHANGE_THIS_TO_A_STRONG_RANDOM_STRING

# =============================================================================
# HTTPS/TLS CONFIGURATION (Requirement 36.1)
# =============================================================================

# Node Environment (production enables HTTPS-only features)
NODE_ENV=production

# Force HTTPS in production
FORCE_HTTPS=true

# =============================================================================
# PASSWORD POLICY (Requirement 36.3)
# =============================================================================

# Password requirements (enforced by validation middleware)
# - Minimum 8 characters
# - Must contain uppercase letter
# - Must contain lowercase letter
# - Must contain number
# - Must contain special character (@$!%*?&)

# =============================================================================
# ACCOUNT LOCKOUT (Requirement 36.4)
# =============================================================================

# Maximum failed login attempts before lockout
MAX_LOGIN_ATTEMPTS=5

# Lockout duration in minutes
LOCKOUT_DURATION=30

# Time window for counting failed attempts (minutes)
FAILED_ATTEMPT_WINDOW=15

# =============================================================================
# CORS CONFIGURATION
# =============================================================================

# Allowed origins (comma-separated list)
# Production: Use your actual frontend domain(s)
# Development: http://localhost:3000
ALLOWED_ORIGINS=https://yourdomain.com,https://www.yourdomain.com

# =============================================================================
# RATE LIMITING
# =============================================================================

# Maximum requests per minute per user
RATE_LIMIT_MAX=100

# Rate limit window in minutes
RATE_LIMIT_WINDOW=1

# =============================================================================
# CSRF PROTECTION (Requirement 36.5)
# =============================================================================

# CSRF protection is enabled by default
# Token validity: 24 hours
# Double-submit cookie pattern used

# =============================================================================
# AUDIT LOGGING (Requirement 36.8)
# =============================================================================

# Enable audit logging
AUDIT_LOGGING_ENABLED=true

# Audit log retention period (days)
AUDIT_LOG_RETENTION_DAYS=365

# Log level (error, warn, info, debug)
LOG_LEVEL=info

# =============================================================================
# DATABASE SECURITY
# =============================================================================

# Database credentials (use strong passwords)
DB_HOST=localhost
DB_PORT=3306
DB_NAME=school_management_system
DB_USER=sms_user
DB_PASSWORD=CHANGE_THIS_TO_A_STRONG_DATABASE_PASSWORD

# Database connection pool settings
DB_POOL_MIN=2
DB_POOL_MAX=10

# =============================================================================
# REDIS SECURITY
# =============================================================================

# Redis credentials
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=CHANGE_THIS_TO_A_STRONG_REDIS_PASSWORD

# =============================================================================
# BACKUP CONFIGURATION (Requirement 36.9)
# =============================================================================

# Enable automated backups
BACKUP_ENABLED=true

# Backup schedule (cron format: "0 2 * * *" = daily at 2 AM)
BACKUP_SCHEDULE=0 2 * * *

# Backup retention period (days)
BACKUP_RETENTION_DAYS=30

# Backup storage path
BACKUP_PATH=./backups

# External backup location (optional, for offsite backups)
BACKUP_EXTERNAL_PATH=/mnt/backup

# Enable backup compression
BACKUP_COMPRESSION=true

# =============================================================================
# FILE UPLOAD SECURITY
# =============================================================================

# Maximum file upload size (bytes)
MAX_FILE_SIZE=10485760  # 10MB

# Allowed file types (comma-separated)
ALLOWED_FILE_TYPES=image/jpeg,image/png,image/gif,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document

# File upload directory
UPLOAD_DIR=./uploads

# =============================================================================
# PAYMENT GATEWAY SECURITY (Requirement 36.10)
# =============================================================================

# eSewa Configuration
ESEWA_MERCHANT_ID=your_esewa_merchant_id
ESEWA_MERCHANT_SECRET=your_esewa_merchant_secret
ESEWA_BASE_URL=https://esewa.com.np/epay/main

# Khalti Configuration
KHALTI_PUBLIC_KEY=your_khalti_public_key
KHALTI_SECRET_KEY=your_khalti_secret_key
KHALTI_BASE_URL=https://a.khalti.com/api/payment/

# IME Pay Configuration
IMEPAY_MERCHANT_CODE=your_imepay_merchant_code
IMEPAY_USERNAME=your_imepay_username
IMEPAY_PASSWORD=your_imepay_password
IMEPAY_BASE_URL=https://dev.imepay.com.np:7979/api/WebLogin/Decrypt

# =============================================================================
# SMS GATEWAY SECURITY
# =============================================================================

# Sparrow SMS Configuration
SPARROW_SMS_TOKEN=your_sparrow_sms_token
SPARROW_SMS_SENDER_ID=your_sender_id
SPARROW_SMS_BASE_URL=https://api.sparrowsms.com

# =============================================================================
# SECURITY HEADERS
# =============================================================================

# Content Security Policy (configured in middleware/security.ts)
# Helmet middleware automatically sets secure headers

# =============================================================================
# MONITORING AND ALERTS
# =============================================================================

# Enable security monitoring
SECURITY_MONITORING_ENABLED=true

# Alert email for security incidents
SECURITY_ALERT_EMAIL=security@yourdomain.com

# =============================================================================
# ADDITIONAL SECURITY SETTINGS
# =============================================================================

# Session timeout (minutes)
SESSION_TIMEOUT=30

# JWT token expiry
JWT_ACCESS_EXPIRY=30m
JWT_REFRESH_EXPIRY=7d

# Enable two-factor authentication (optional)
ENABLE_2FA=false

# =============================================================================
# SECURITY CHECKLIST
# =============================================================================

# Before deploying to production, ensure:
# [ ] All secrets are changed from defaults
# [ ] JWT secrets are at least 32 characters
# [ ] Encryption key is exactly 64 hex characters
# [ ] Database password is strong
# [ ] Redis password is set
# [ ] CORS origins are restricted to production domains
# [ ] HTTPS is enabled
# [ ] Backups are configured and tested
# [ ] Audit logging is enabled
# [ ] Rate limiting is configured
# [ ] File upload restrictions are in place
# [ ] Payment gateway credentials are correct
# [ ] Security monitoring is enabled
# [ ] All environment variables are set

# =============================================================================
# GENERATE SECRETS
# =============================================================================

# Use these commands to generate secure secrets:

# JWT Secret (32+ characters):
# node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"

# Encryption Key (exactly 64 hex characters):
# node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"

# Session Secret:
# node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"

# Strong Password:
# node -e "console.log(require('crypto').randomBytes(16).toString('base64'))"
